<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4 Pics 1 Word - Wind Turbine</title>
    <!-- Carga de Tailwind CSS (CDN) - Sin dependencias de servidor -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117; /* Fondo oscuro */
        }
        /* Estilos personalizados para los botones y slots */
        .game-card {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            border: 1px solid #2a333d;
            background-color: #161b22;
        }
        .image-container {
            aspect-ratio: 1 / 1;
            background-size: cover;
            background-position: center;
            border: 4px solid #2a333d;
            transition: transform 0.2s;
            /* Asegúrate de que las imágenes no causen errores si no existen */
            background-image: url('https://placehold.co/200x200/2a333d/ffffff?text=Cargando...'); 
        }
        .image-container:hover {
            transform: scale(1.03);
            border-color: #00a9e0; /* Color de resaltado azul */
        }
        .slot, .letter-button {
            transition: all 0.15s ease-in-out;
            cursor: pointer;
            user-select: none;
            text-transform: uppercase;
            font-weight: 700;
        }
        .slot {
            background-color: #1f242b;
            color: #ffffff;
            border: 2px solid #30363d;
        }
        .slot.filled {
            background-color: #2a333d;
        }
        .letter-button {
            background-color: #21262d;
            color: #c9d1d9;
            border: 1px solid #30363d;
        }
        .letter-button:hover:not(:disabled) {
            background-color: #30363d;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        .letter-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen text-white">

    <div class="max-w-3xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-extrabold text-[#00a9e0] tracking-tight">4 Pics 1 Word</h1>
            <p class="text-xl text-gray-400 mt-2">What part of the wind turbine do they have in common?</p>
            <div id="level-indicator" class="mt-4 text-2xl font-bold text-green-400">Nivel 1 / 5</div>
        </header>

        <!-- Contenedor Principal del Juego -->
        <div class="game-card p-6 rounded-xl">
            
            <!-- Contenedor de las 4 Imágenes -->
            <div id="image-grid" class="grid grid-cols-2 gap-4 mb-8">
                <!-- Las imágenes se cargarán aquí por JavaScript -->
            </div>

            <!-- Slots de la Palabra (Adivinanza) -->
            <div class="text-center mb-8">
                <div id="guess-slots" class="flex justify-center flex-wrap gap-2 md:gap-4">
                    <!-- Los slots de las letras se cargarán aquí -->
                </div>
            </div>

            <!-- Panel de Mensajes (Éxito/Error) -->
            <div id="message-panel" class="min-h-8 text-center mb-6"></div>

            <!-- Botones de Letras Disponibles -->
            <div id="letter-buttons-container" class="flex justify-center flex-wrap gap-2 p-4 bg-[#1f242b] rounded-lg border border-[#2a333d]">
                <!-- Los botones de letras se cargarán aquí -->
            </div>
            
            <!-- Botón de Reinicio (Opcional) -->
            <div class="mt-6 flex justify-center">
                <button id="reset-button" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition" onclick="resetGame()">
                    Reset
                </button>
            </div>
        </div>

        <!-- Panel de Estado (Modo Estático) -->
        <footer class="mt-8 text-xs text-gray-500 text-center">
            <p>Uabcs.</p>
        </footer>

    </div>

    <!-- Script del Juego (Vanilla JS) -->
    <script>
        // --- DATA DEL JUEGO ---
        // NOTA: Usa nombres de archivos locales (ej: tower_1.jpg)
        const gameData = [
            // Nivel 1: TOWER (TORRE)
            { 
                answer: 'TOWER', 
                images: [
                    'tower_1.jpg',
                    'tower_2.jpg',
                    'tower_3.jpg',
                    'tower_4.jpg'
                ],
                letters: 'TOWERPKD' 
            },
            // Nivel 2: ROTOR
            { 
                answer: 'ROTOR', 
                images: [
                    'rotor_1.jpg',
                    'rotor_2.jpg',
                    'rotor_3.jpg',
                    'rotor_4.jpg'
                ],
                letters: 'ROTORNBE' 
            },
            // Nivel 3: BLADES (PALAS)
            { 
                answer: 'BLADES', 
                images: [
                    'blades_1.jpg',
                    'blades_2.jpg',
                    'blades_3.jpg',
                    'blades_4.jpg'
                ],
                letters: 'BLADESGI' 
            },
            // Nivel 4: NACELLE (GÓNDOLA)
            { 
                answer: 'NACELLE', 
                images: [
                    'nacelle_1.jpg',
                    'nacelle_2.jpg',
                    'nacelle_3.jpg',
                    'nacelle_4.jpg'
                ],
                letters: 'NACELLEFJ' 
            },
            // Nivel 5: FOUNDATION (CIMENTACIÓN)
            { 
                answer: 'FOUNDATION', 
                images: [
                    'foundation_1.jpg',
                    'foundation_2.jpg',
                    'foundation_3.jpg',
                    'foundation_4.jpg'
                ],
                letters: 'FOUNDATIONCS' 
            }
        ];

        // --- ESTADO DEL JUEGO (Usando localStorage para guardar) ---
        let gameState = {
            levelIndex: 0,
            currentGuess: [],
            letterMapping: [], // Para rastrear qué botón corresponde a qué slot
            score: 0
        };

        // --- ELEMENTOS DEL DOM ---
        const imageGridEl = document.getElementById('image-grid');
        const guessSlotsEl = document.getElementById('guess-slots');
        const letterButtonsContainerEl = document.getElementById('letter-buttons-container');
        const levelIndicatorEl = document.getElementById('level-indicator');
        const messagePanelEl = document.getElementById('message-panel');
        const MAX_LEVEL = gameData.length;

        const GAME_STATE_KEY = 'fourPicsOneWordState';

        // --- FUNCIONES DE PERSISTENCIA (localStorage) ---

        const saveGameState = () => {
            try {
                localStorage.setItem(GAME_STATE_KEY, JSON.stringify({
                    levelIndex: gameState.levelIndex,
                    score: gameState.score
                }));
            } catch (e) {
                console.error("Error al guardar en localStorage:", e);
            }
        };

        const loadGameState = () => {
            try {
                const storedState = localStorage.getItem(GAME_STATE_KEY);
                if (storedState) {
                    const data = JSON.parse(storedState);
                    gameState.levelIndex = data.levelIndex || 0;
                    gameState.score = data.score || 0;
                }
            } catch (e) {
                console.error("Error al cargar de localStorage:", e);
            }
            // Iniciar el juego después de intentar cargar el estado
            initGame();
        };

        // --- FUNCIONES DE JUEGO ---

        const shuffleArray = (array) => {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        };

        // Hacemos esta función globalmente accesible para el onclick del botón HTML.
        window.resetGame = function() {
            gameState.levelIndex = 0;
            gameState.score = 0;
            gameState.currentGuess = [];
            messagePanelEl.innerHTML = '<span class="text-yellow-400">reset.</span>';
            saveGameState();
            renderLevel();
        }

        const renderLevel = () => {
            if (gameState.levelIndex >= MAX_LEVEL) {
                showWinScreen();
                return;
            }

            const current = gameData[gameState.levelIndex];
            const answer = current.answer;
            const letters = current.letters.split('');
            shuffleArray(letters); // Mezclar letras disponibles
            
            gameState.currentGuess = Array(answer.length).fill(null);
            gameState.letterMapping = Array(answer.length).fill(null);
            messagePanelEl.textContent = '';
            messagePanelEl.className = 'min-h-8 text-center mb-6';

            levelIndicatorEl.textContent = `Nivel ${gameState.levelIndex + 1} / ${MAX_LEVEL}`;

            // 1. Renderizar Imágenes (usando nombres de archivos locales)
            imageGridEl.innerHTML = current.images.map(imageName => `
                <div class="image-container rounded-lg" style="background-image: url('./${imageName}');"></div>
            `).join('');

            // 2. Renderizar Slots de la Palabra
            guessSlotsEl.innerHTML = gameState.currentGuess.map((_, index) => `
                <div id="slot-${index}" data-index="${index}" class="slot w-10 h-10 md:w-12 md:h-12 flex items-center justify-center rounded-md text-xl border-dashed" onclick="handleSlotClick(${index})"></div>
            `).join('');

            // 3. Renderizar Botones de Letras
            letterButtonsContainerEl.innerHTML = letters.map((letter, index) => `
                <button id="lbtn-${index}" data-letter="${letter}" data-original-index="${index}" 
                    class="letter-button w-10 h-10 md:w-12 md:h-12 rounded-md text-lg shadow-md" 
                    onclick="handleLetterClick(this)">${letter}</button>
            `).join('');
        };

        // Manejadores de Eventos Globales
        window.handleLetterClick = (button) => {
            const letter = button.getAttribute('data-letter');
            const originalIndex = button.getAttribute('data-original-index');

            // Buscar el primer slot vacío
            const emptyIndex = gameState.currentGuess.findIndex(l => l === null);

            if (emptyIndex !== -1) {
                // Llenar el slot
                gameState.currentGuess[emptyIndex] = letter;
                gameState.letterMapping[emptyIndex] = originalIndex;

                const slotEl = document.getElementById(`slot-${emptyIndex}`);
                slotEl.textContent = letter;
                slotEl.classList.remove('border-dashed');
                slotEl.classList.add('filled');
                
                // Deshabilitar el botón
                button.disabled = true;

                // Revisar la respuesta después de que el último slot se llene
                if (!gameState.currentGuess.includes(null)) {
                    checkAnswer();
                }
            }
        };

        window.handleSlotClick = (slotIndex) => {
            const slotEl = document.getElementById(`slot-${slotIndex}`);
            const letter = gameState.currentGuess[slotIndex];

            if (letter !== null) {
                // Obtener el índice original del botón
                const originalIndex = gameState.letterMapping[slotIndex];
                const buttonEl = document.getElementById(`lbtn-${originalIndex}`);

                // Restaurar el botón
                if (buttonEl) {
                    buttonEl.disabled = false;
                }

                // Vaciar el slot
                gameState.currentGuess[slotIndex] = null;
                gameState.letterMapping[slotIndex] = null;
                slotEl.textContent = '';
                slotEl.classList.remove('filled');
                slotEl.classList.add('border-dashed');
                
                // Limpiar mensaje de error si existe
                messagePanelEl.textContent = '';
                messagePanelEl.className = 'min-h-8 text-center mb-6';
            }
        };

        const checkAnswer = () => {
            const currentAnswer = gameData[gameState.levelIndex].answer;
            const userGuess = gameState.currentGuess.join('');

            if (userGuess === currentAnswer) {
                gameState.score += 100;
                messagePanelEl.innerHTML = `<span class="text-green-500 font-bold text-xl">¡CORRECT! ${currentAnswer}</span><div class="mt-2"><button id="next-level-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg transition" onclick="nextLevel()">Next level</button></div>`;
                saveGameState();
            } else {
                messagePanelEl.innerHTML = `<span class="text-red-500 font-bold">Incorrect answer. Try again.</span>`;
            }
        };

        window.nextLevel = () => {
            gameState.levelIndex++;
            renderLevel();
        };
        
        const showWinScreen = () => {
            levelIndicatorEl.textContent = 'Game Over!';
            imageGridEl.innerHTML = `
                <div class="col-span-2 text-center p-8 bg-green-900/50 rounded-lg">
                    <span class="text-6xl mb-4 block" role="img" aria-label="Trophy">🏆</span>
                    <h2 class="text-3xl font-bold mb-2">Congratulations, you have completed all the levels!</h2>
                    <p class="text-xl text-gray-300">Your final score is:<span class="text-yellow-400">${gameState.score}</span> score.</p>
                    <button class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition" onclick="resetGame()">Play again</button>
                </div>
            `;
            guessSlotsEl.innerHTML = '';
            letterButtonsContainerEl.innerHTML = '';
            messagePanelEl.textContent = '';
            saveGameState();
        };

        // Función de inicialización
        const initGame = () => {
            // Carga el estado del juego (o inicia de cero) y renderiza el nivel
            renderLevel();
        };

        // Inicia el juego al cargar la página
        window.onload = loadGameState;
    </script>
</body>
</html>

